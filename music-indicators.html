<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Antal">
<meta name="dcterms.date" content="2023-06-29">
<meta name="keywords" content="Indicators, Open Music Europe">

<title>Indicators in Open Music Europe</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="music-indicators_files/libs/clipboard/clipboard.min.js"></script>
<script src="music-indicators_files/libs/quarto-html/quarto.js"></script>
<script src="music-indicators_files/libs/quarto-html/popper.min.js"></script>
<script src="music-indicators_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="music-indicators_files/libs/quarto-html/anchor.min.js"></script>
<link href="music-indicators_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="music-indicators_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="music-indicators_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="music-indicators_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="music-indicators_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Indicators in Open Music Europe</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Daniel Antal </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 29, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#from-data-to-indicators" id="toc-from-data-to-indicators" class="nav-link active" data-scroll-target="#from-data-to-indicators">From data to indicators</a></li>
  <li><a href="#from-indicators-to-policies" id="toc-from-indicators-to-policies" class="nav-link" data-scroll-target="#from-indicators-to-policies">From indicators to policies</a></li>
  <li><a href="#interactive-communication-of-indicators-and-open-policy-analysis" id="toc-interactive-communication-of-indicators-and-open-policy-analysis" class="nav-link" data-scroll-target="#interactive-communication-of-indicators-and-open-policy-analysis">Interactive communication of indicators and Open Policy Analysis</a></li>
  <li><a href="#list-of-figures" id="toc-list-of-figures" class="nav-link" data-scroll-target="#list-of-figures">List of Figures</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="music-indicators.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="music-indicators.docx"><i class="bi bi-file-word"></i>MS Word</a></li><li><a href="music-indicators.epub"><i class="bi bi-file"></i>ePub</a></li></ul></div></nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a manuscript developed for <a href="https://openmuse.eu/">Open Music Europe</a> following the Open Policy Analysis Guidelines. All materials related to this research can be found in the open repository at <a href="https://github.com/antaldaniel/music-indicators-description">https://github.com/antaldaniel/music-indicators-description</a>. Bookmark this document as a <a href="https://antaldaniel.github.io/music-indicators-description/music-indicators.html">webpage</a>. DOI: <a href="https:://doi.org/10.5281/zenodo.8096811">10.5281/zenodo.8096811</a>.</p>
</div>
</div>
<p><code>Open Music Europe</code> offers a ‘data-to-policy’ pipeline, which extends the music data pipeline to evidence-based business and policy administration. A data pipeline is a method in which raw data is ingested from various data sources and then ported to data store, for further analysis, in this case, to an open, shared, collaborative music observatory. We extend this pipeline using reproducible research techniques, a novel application of the <em>Open Policy Analysis Guidelines</em>, and good statistical practices to support evidence-based policy analysis, scientific music research and sound business strategy building. In this last leg of the pipeline, we emphasise usability for our project’s target audiences and good documentation practices. We want to ensure that our data is high quality and well understood to support robust and correct business, scientific or policy conclusions. This usually makes processing the data into an indicator, or a set of indicators, which are often displayed as a scoreboard, dashboard, or as a part of a standardised business or policy report.</p>
<section id="from-data-to-indicators" class="level2">
<h2 class="anchored" data-anchor-id="from-data-to-indicators">From data to indicators</h2>
<p>The use of indicators is widespread in the economics, business, social aspects, or public policies of music and the broader cultural and creative industries agenda. A statistical indicator summarises a key issue or phenomenon derived from a series of observed facts; it is a generalisation of the information in the data. It is often compared metaphorically to traffic signs that help travelers to arrive to their destinations safely. The knowledge we gain from indicators is used to uncover social, environmental or economic phenomena and establish connections between them. It also provides a basis for influencing and controlling such phenomena on a business level (for example, key performance indicators) or the level of public policy (for example, <em>ex ante</em> and <em>ex post</em> evaluation indicators.)</p>
<blockquote class="blockquote">
<p>A statistical indicator is a summary measure related to a key issue or phenomenon and derived from a series of observed facts. [<span class="citation" data-cites="kotzeva_towards_2017">Kotzeva et al. (<a href="#ref-kotzeva_towards_2017" role="doc-biblioref">2017</a>)</span>, pp.&nbsp;7]<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</blockquote>
<p>A <code>statistical indicator</code>, or simply, <code>indicator</code>, is the representation of statistical data for a specified time, place or any other relevant characteristic, corrected for at least one dimension (usually size) so as to allow for meaningful comparisons. It is a summary measure related to a key issue or phenomenon and derived from a series of observed facts.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://doi.org/10.6084/m9.figshare.23600571"><img src="plots/statistical_infrastructure_for_indicators.png" class="img-fluid figure-img" style="width:90.0%" alt="The statistical infrastructure of indicators, DOI: https://doi.org/10.6084/m9.figshare.23600571"></a></p>
<figcaption class="figure-caption">The statistical infrastructure of indicators, DOI: https://doi.org/10.6084/m9.figshare.23600571</figcaption>
</figure>
</div>
<p>Statistical indicators, or, in short, indicators, are derived from accounting systems and statistical data. Accounting systems are coherent and integrated accounts, balance sheets and tables based on a set of agreed rules. Statistical data is also collected based on agreed and coherent rules.</p>
<p>The aim of statistical data collection is the creation of sets of data that can be generalised well; for example, when we collect data about people, it includes data on people from all relevant age or gender groups. <code>Open Music Europe</code> is using and developing data collection from primary sources, such as surveys and ephemeral big data, or taking samples of large, pre-existing but biased datasets, such as royalty accounts.</p>
</section>
<section id="from-indicators-to-policies" class="level2">
<h2 class="anchored" data-anchor-id="from-indicators-to-policies">From indicators to policies</h2>
<p>Indicators should be used as traffic signs, and not as route plans. Indicators do not give an explanation to a problem or reveal a solution; they must be interpreted in the context of domain-specific knowledge. While the word <em>policy</em> is very often used in the context of public policies, we use it in a more general meaning: a course or principle of action adopted or proposed by an organization or individual. <code>Open Music Europe</code> does not offer tailored data analysis for organisations or individuals, it offers indicators and other data products that can help the setting of policies for public policy, for-profit and social music enterprises, and hopefully even for individual creators. We would like to do this with placing indicators into reproducible reports. These reports contextualize our indicators, and end the data-to-policy pipeline.</p>
<blockquote class="blockquote">
<p>Unlike the data from which they are derived, indicators are used for specific purposes. The specific purpose of an indicator is determined by its context, the questions it seeks to answer, and the party or parties asking these questions. <span class="citation" data-cites="eurostat_towards_2014">(<a href="#ref-eurostat_towards_2014" role="doc-biblioref">Eurostat 2014, 1:p7</a>)</span></p>
</blockquote>
<p>Indicators are used for specific purposes to support decisions with generalised information derived from the data. The specific purpose of an indicator is determined by its context, the questions it seeks to answer, and the party or parties asking these questions.</p>
<p>There are many conceptualisations on how policies should be set for public organizations or businesses; a review of policy cycles is beyond the scope of this paper. For presentation purposes, we use the policy cylce framework of …. adopted by Eurostat for indicator design guidance.</p>
<p>In an evidence-based policy cycle indicators should be provide different factual information. Different indicators may be needed in the first, <code>Concept</code> phase when a business or public body is seeking alternatives to solve a problem: for example, to increase royalty revenue for their artists or assets, and in the final <code>Outcome</code> or <code>Impact</code> assessment. While impact assessment is often associated with public policy, the current sustainability management techniques require music businesses to implement processes that reduce, for example, fossil fuel use, and eventually have a positive impact (in quantitative terms, a negative change) on greenhouse gas emissions.</p>
<div id="policy_evaluation_cycle_with_indicator">
<p><a href="https://doi.org/10.6084/m9.figshare.23498441"><img src="plots/policy_evaluation_cycle_with_indicators.jpg" class="img-fluid" alt="Figure 2. Policy evaluation cycle with indicators, DOI: 10.6084/m9.figshare.23498441"></a></p>
<p>Figure 2. Policy evaluation cycle with indicators, DOI: 10.6084/m9.figshare.23498441</p>
</div>
<p>Following the data pillars of the <em>Feasibility Study</em>, we foresee the indicators made in our sample reports with the following topics:</p>
<ul>
<li><p><strong>Report on the European Music Economy</strong>: Support stakeholders with economic questions, such as taxation, price-setting and economic exploitation, and advocating for policies that better support the development of the industry or its parts like publishing <span class="citation" data-cites="open_music_europe_economy_repository">(<a href="#ref-open_music_europe_economy_repository" role="doc-biblioref">Open Music Europe 2023d</a>)</span>.</p></li>
<li><p><strong>Report on Music Diversity and Circulation in Europe</strong>: Local content regulations, maintaining the diversity of music circulation in Europe, and other aspects of diversity <span class="citation" data-cites="open_music_europe_diversity_repository">(<a href="#ref-open_music_europe_diversity_repository" role="doc-biblioref">Open Music Europe 2023a</a>)</span>.</p></li>
<li><p><strong>Report on Music, Society, and Citizenship in Europe</strong>: Inform about the societal aspects of music, amateur practices, education, and sustainability <span class="citation" data-cites="open_music_europe_society_repository">(<a href="#ref-open_music_europe_society_repository" role="doc-biblioref">Open Music Europe 2023c</a>)</span>.</p></li>
<li><p><strong>Report on Music Innovation &amp; Technology in Europe</strong>: Novel data-driven applications <span class="citation" data-cites="open_music_europe_innovation_repository_2023">(<a href="#ref-open_music_europe_innovation_repository_2023" role="doc-biblioref">Open Music Europe 2023b</a>)</span>.</p></li>
</ul>
</section>
<section id="interactive-communication-of-indicators-and-open-policy-analysis" class="level2">
<h2 class="anchored" data-anchor-id="interactive-communication-of-indicators-and-open-policy-analysis">Interactive communication of indicators and Open Policy Analysis</h2>
<p>Indicators are most important in communicating data in a business or public policy context. To discuss this communication, it is helpful to distinguish between simple one-directional information transmission and communication as an interactive process. The informational or one-directional communication of indicators focuses on information transmission between a sender and a receiver. The interactive communication of indicators means that the message is actively constructed by both the sender and the receiver(s), who exchange information in a feedback loop.</p>
<blockquote class="blockquote">
<p>Like the mediators who strive to communicate between different parties to find their point of agreement, communication through indicators allows to overpass boundaries between policy, science, statistics and public debate. Thus indicators are able to reveal various phenomena to different user groups — policy makers, researchers, citizens, journalists, statisticians, specialists in different domains. Reaching various types of audiences through their communication function, indicators can ensure that statistics are usable and useful <span class="citation" data-cites="kotzeva_towards_2017">(<a href="#ref-kotzeva_towards_2017" role="doc-biblioref">Kotzeva et al. 2017, 2:p7</a>.)</span>.</p>
</blockquote>
<p>Going back to the often used traffic management example, a simple one-directional indicator is a speed limit sign on a static road sign; a more interactive version uses sensors and cameras to measure the actual traffic density and to recommend a speed at which vechicles will not jam the road.</p>
<p>Interactivity allows for exchange of ideas and a shared creation of the intended content of the message that the planned indicator conveys. This requires user involvement in the construction of indicators and indicator sets. The developed indicators need to be based on a wide consensus reached through a dialogue involving as many potential user groups as appropriate. This way they can have their say on the relevance of the statistical message. For example, on Digital Streaming Platforms (DSPs) a music creator or label is facing with hundreds of hidden prices. One of our aims is to create price indicators that help a music label, distributor or a band to direct marketing efforts towards more valuable streaming segments. We need to create a price indicator that is as simple as a stock exchange index which is often followed by small and institutional investors alike.</p>
<blockquote class="blockquote">
<p>PRINCIPLE 11 Relevance: European Statistics meet the needs of users. 11.1. Procedures are in place to consult users, to monitor the relevance and value of existing statistics in meeting their needs, and to consider and anticipate their emerging needs and priorities. Innovation is pursued to continuously improve statistical output. 11.2 Priority needs are being met and reflected in the work programme. 11.3 User satisfaction is monitored on a regular basis and is systematically followed up.</p>
</blockquote>
<p>The <em>European Statistics Code of Practice</em> <span class="citation" data-cites="european_statistics_code_of_practice_2017">(<a href="#ref-european_statistics_code_of_practice_2017" role="doc-biblioref">European Statistical System Committee 2018</a>)</span> see the <em>Quality Assurance Framework of the European Statistical System</em> <span class="citation" data-cites="ESS_QAF_2019">(<a href="#ref-ESS_QAF_2019" role="doc-biblioref">European Statistical System 2019, 45–46</a>)</span> goes a step further in interactivity. The idea of interactivity in the statistical indicator design process originates in the the European Commission’s <em>more-than-information approach</em>: „Communication is more than information: it establishes a relationship and initiates a dialogue with European citizens, it listens carefully and it connects to people. It is not a neutral exercise devoid of value, it is an essential part of the political process.” The Commission refers here instead of the ‘target audience’ to ‘citizens’ because communication is not just a technical exercise of message delivery but part of a democratic involvement of citizens <span class="citation" data-cites="kotzeva_towards_2017">(<a href="#ref-kotzeva_towards_2017" role="doc-biblioref">Kotzeva et al. 2017, 2:p7</a>.)</span>. Similarly, a good business indicator is not only printed in the annual financial or sustainability reports of a company: it is often cited in management discussions or communicated by line managers to workers to direct their focus. To make indicators conversation-starters or arguments in professional discussions, we have to ensure their usability: we not only need to involve potential users in the design phase, but we have to get regular feedback on the usability and professional improvement of the indicators.</p>
</section>
<section id="list-of-figures" class="level2">
<h2 class="anchored" data-anchor-id="list-of-figures">List of Figures</h2>
<p>Figure 1: <em>The statistical infrastructure of indicators</em>, DOI: <a href="https://doi.org/10.6084/m9.figshare.23600571">10.6084/m9.figshare.23600571</a><br>
Figure 2: <em>Policy evaluation cycle with indicators</em>, DOI: <a href="https://figshare.com/account/projects/129944/articles/23498441">10.6084/m9.figshare.23498441</a></p>
</section>
<section id="references" class="level2 unnumbered">


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-policy_evaluation_cycle_with_indicators_2023" class="csl-entry" role="listitem">
Antal, Daniel. 2023a. <span>“Policy Evaluation Cycle with Indicators.”</span> <span>Digital Music Observatory</span>. <a href="https://doi.org/10.6084/m9.figshare.23498441">https://doi.org/10.6084/m9.figshare.23498441</a>.
</div>
<div id="ref-statistical_infrastructure_indicators_2023" class="csl-entry" role="listitem">
———. 2023b. <span>“The Statistical Infrastructure of Indicators.”</span> <span>Digital Music Observatory</span>. <a href="https://doi.org/10.6084/m9.figshare.23600571">https://doi.org/10.6084/m9.figshare.23600571</a>.
</div>
<div id="ref-ESS_QAF_2019" class="csl-entry" role="listitem">
European Statistical System. 2019. <span>“Quality Assurance Framework of the European Statistical System. 2019 Edition (Version 2.0).”</span> <a href="https://ec.europa.eu/eurostat/documents/64157/4392716/ESS-QAF-V1-2final.pdf/bbf5970c-1adf-46c8-afc3-58ce177a0646">https://ec.europa.eu/eurostat/documents/64157/4392716/ESS-QAF-V1-2final.pdf/bbf5970c-1adf-46c8-afc3-58ce177a0646</a>.
</div>
<div id="ref-european_statistics_code_of_practice_2017" class="csl-entry" role="listitem">
European Statistical System Committee. 2018. <em>European Statistics Code of Practice — Revised Edition 2017. English Version.</em> Luxembourg: Publications Office of the European Union. <a href="https://ec.europa.eu/eurostat/web/products-catalogues/-/ks-02-18-142">https://ec.europa.eu/eurostat/web/products-catalogues/-/ks-02-18-142</a>.
</div>
<div id="ref-eurostat_towards_2014" class="csl-entry" role="listitem">
Eurostat. 2014. <em>Towards a Harmonised Methodology for Statistical Indicators — Part 1: Indicator Typologies and Terminologies</em>. 2014th ed. Vol. 1. Towards a Harmonised Methodology for Statistical Indicators 1. Luxembourg: Publications Office of the European Union. <a href="https://ec.europa.eu/eurostat/web/products-manuals-and-guidelines/-/KS-GQ-14-011">https://ec.europa.eu/eurostat/web/products-manuals-and-guidelines/-/KS-GQ-14-011</a>.
</div>
<div id="ref-kotzeva_towards_2017" class="csl-entry" role="listitem">
Kotzeva, Mariana, Anton Steurer, Nicola Massarelli, and Mariana Popova, eds. 2017. <em>Towards a Harmonised Methodology for Statistical Indicators — Part 2: Communicating Through Indicators</em>. 2017th ed. Vol. 2. Towards a Harmonised Methodology for Statistical Indicators 1. Luxembourg: Publications Office of the European Union. <a href="https://ec.europa.eu/eurostat/web/products-manuals-and-guidelines/-/KS-GQ-17-001">https://ec.europa.eu/eurostat/web/products-manuals-and-guidelines/-/KS-GQ-17-001</a>.
</div>
<div id="ref-open_music_europe_diversity_repository" class="csl-entry" role="listitem">
Open Music Europe. 2023a. <span>“Repository: Report on Music Diversity and Circulation in Europe. <span>GitHub</span>.”</span> Open Policy Analysis Repository with Standardized File Structure. 2023. <a href="https://github.com/dataobservatory-eu/report-music-diversity-circulation-europe/">https://github.com/dataobservatory-eu/report-music-diversity-circulation-europe/</a>.
</div>
<div id="ref-open_music_europe_innovation_repository_2023" class="csl-entry" role="listitem">
———. 2023b. <span>“Report on Music Innovation &amp; Technology in Europe. <span>GitHub</span>.”</span> Open Policy Analysis Repository with Standardized File Structure. March 25, 2023. <a href="https://github.com/dataobservatory-eu/report-music-innovation-technology">https://github.com/dataobservatory-eu/report-music-innovation-technology</a>.
</div>
<div id="ref-open_music_europe_society_repository" class="csl-entry" role="listitem">
———. 2023c. <span>“Repository: Report on Music, Society, and Citizenship in Europe. <span>GitHub</span>.”</span> Open Policy Analysis Repository with Standardized File Structure. March 25, 2023. <a href="https://github.com/dataobservatory-eu/report-music-society-citizenship">https://github.com/dataobservatory-eu/report-music-society-citizenship</a>.
</div>
<div id="ref-open_music_europe_economy_repository" class="csl-entry" role="listitem">
———. 2023d. <span>“Repository: Report on the European Music Economy. <span>GitHub</span>.”</span> Open Policy Analysis Repository with Standardized File Structure. March 26, 2023. <a href="https://github.com/dataobservatory-eu/report-european-music-economy">https://github.com/dataobservatory-eu/report-european-music-economy</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The definition of the statistical indicator originates from the Regulation 99/2013 of 15 January 2013 on the European statistical programme 2013-17 (Annex I,1: Indicators), which went through several modification and it is no longer in force. In a slightly more verbose format it is part of <a href="https://ec.europa.eu/eurostat/statistics-explained/index.php?title=Glossary:Statistical_indicator">Eurostat’s Glossary</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nd/4.0/">https://creativecommons.org/licenses/by-nd/4.0/</a></div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>